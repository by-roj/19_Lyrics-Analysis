(function(t){t.fn.DrawingGraph=function(e){function n(){_cont=d3.select(d);var e=_cont.select(c);t(d).find(u).on("click",function(){if(g=!1,P.on("touchstart",null).on("touchmove",null),e.classed("open"))return!1;t(this).addClass("dimd"),b.append("path").attr("class","ainmateLine").attr("d",lineSet(v)).attr("stroke-width",f).attr("stroke",x).attr("fill","none");var n=s.selectAll(".ainmateLine").node().getTotalLength();return b.selectAll(".ainmateLine").attr("stroke-dasharray",n+" "+n).attr("stroke-dashoffset",n).transition().ease("quad").duration(800).attr("stroke-dashoffset",0).each("end",function(e){s.select(".circlePoint.dimd").classed("dimd",!1).attr("fill",x),s.select(".numText.dimd").classed("dimd",!1),t(d).addClass("open"),t(d).find(c).addClass("open")}),!1}),w=e.append("svg").attr("width",A).attr("height",N).append("g").attr("transform","translate("+m.left+","+m.top+")"),C=w.append("g").attr("class","grid"),L=C.append("g").attr("class","y_grid");var n=C.append("g").attr("class","x_grid");P=w.append("g").attr("class","drawAreaWrap");var s=w.append("g").attr("class","realLine").attr("width",r-m.left-m.right).attr("height",i-m.top-m.bottom);b=s.append("g"),l.forEach(function(t,e){t.date=t.date,t.value=+t.value,t.money=t.money,t.index=e});var h=d3.min(l,function(t){return t.value}),y=d3.scale.linear().domain([T,B]).range([i,0]),k=[];l.forEach(function(t,e){var n=e*D;_.push([n,y(t.value)]),e<=o&&k.push([n,y(t.value)]),e>=o&&v.push([n,y(t.value)])});var W=C.selectAll("text").data(l).enter().append("text").attr("dx",function(t){return t.index*D}).attr("dy",-8).classed("grid_Xnum",!0).classed("dimd",!0).text(function(t){return t.date}).attr("font-size","13px").attr("text-anchor","middle");W.filter(function(t){return 0==t.index||t.index==o||t.index==S}).attr("fill","#333").attr("dy",i+20).classed("dimd",!1),W.filter(function(t){return 0==t.index}).attr("dx",function(t){return t.index*D-10}).attr("text-anchor","start"),W.filter(function(t){return t.index==S}).attr("dx",function(t){return t.index*D+10}).attr("text-anchor","end"),C.selectAll("rect").data(l).enter().append("rect").filter(function(t){return 0==t.index||t.index==o||t.index==S}).attr("x",function(t){return t.index*D-1}).attr("y",i-2).attr("width",3).attr("height",7).attr("fill","#424f57"),L.selectAll("line").data(l).enter().append("line").attr("class",function(t){return t.index!=o?"grid_line":"grid_line startLine"}).attr("x1",function(t){return t.index*D}).attr("x2",function(t){return t.index*D}).attr("y1",0).attr("y2",i),n.selectAll("line").data(l).enter().append("line").attr("class",function(t){return t.index!=S?"grid_line":"grid_line axis"}).attr("x1",0).attr("x2",r).attr("y1",function(t){return t.index*(i/S)}).attr("y2",function(t){return t.index*(i/S)}),s.append("g").append("path").attr("d",lineSet(k)).attr("stroke-width",f).attr("stroke",p).attr("fill","none");var M=s.selectAll("circle").data(l).enter().append("circle").filter(function(t){return 0==t.index||t.index==o||t.value==h||t.index==S}).attr("cx",function(t){return t.index*D}).attr("cy",function(t){return y(t.value)}).attr("class","circlePoint").attr("r","6px").attr("fill",p);M.filter(function(t){return t.index==S}).attr("class","circlePoint dimd");var E=s.selectAll("text").data(l).enter().append("text").filter(function(t){return t.index==o||t.value==h||t.index==S}).attr("dx",function(t){return 0==t.index?t.index*D+20:t.index*D}).attr("dy",function(t){return t.value==h?y(t.value)+22:y(t.value)-15}).attr("text-anchor","middle").text(function(t){return t.money+"억 $"}).attr("class","numText");E.filter(function(t){return t.index==S}).attr("dx",function(t){return t.index*D+10}).attr("text-anchor","end").attr("class","numText dimd"),a()}function a(){function t(){return!!g&&(d3.event.stopPropagation(),void d3.event.preventDefault())}function e(){if(p.remove(),!g)return!1;xPosition=d3.mouse(this)[0],yPosition=d3.mouse(this)[1];var t=Math.ceil((xPosition-s-D/2)/D);if(t<=0&&(t=1),t>=l&&(t=l),t>0){var e=yPosition<i?yPosition<0?0:yPosition:i;u[t]=[s+D*t,e]}C.selectAll("text").classed("active",!1),C.selectAll("text").filter(function(e){return e.index==t+o}).classed("active",!0),L.selectAll("line").classed("active",!1),L.selectAll("line").filter(function(e){return e.index==t+o}).classed("active",!0),a(u)}function n(){C.selectAll("text").classed("active",!1),L.selectAll("line").classed("active",!1)}function a(t){P.selectAll("path").remove();P.append("path").attr("d",lineSet(t)).style("stroke-width",f).style("stroke",h).style("stroke-dasharray","2 7").style("stroke-linecap","round").style("fill","none")}var l=S-o,d=D*l,s=r-d,c=_[o][1],u=[];P.append("rect").classed("drawArea",!0).attr("width",d).attr("height",i).attr("transform","translate("+s+",0)").attr("fill","black").attr("opacity",".05");var p=P.append("g").classed("tooltip",!0);p.append("text").attr("dx",s+d/2).attr("dy",i/2-10).attr("text-anchor","middle").text("직접 선을 그어서").attr("fill","#333"),p.append("text").attr("dx",s+d/2).attr("dy",i/2+10).attr("text-anchor","middle").text("예상해 보세요").attr("fill","#333");for(var x=0;x<=l;x++)u.push([s+D*x,c]);var m=d3.behavior.drag().on("dragstart",e).on("drag",e).on("dragend",n);P.call(m),P.on("touchstart",t).on("touchmove",t)}if(e=t.extend({_csvData:null,_mobileChk:!1,_wrap_className:".part1",_chartWrap_className:".chartWrap",_chart_className:".chart",_openBtn_className:".openBtn",_startNum:2,_lineStroke:4,_defaultLineColor_1:"red",_defaultLineColor_2:"green",_drawLineColor:"#333",_margins:{top:12,left:20,right:20,bottom:40},_minNum:0,_maxNum:1e3},e||{}),this.length<=0)return!1;if(null==e._csvData)return!1;var r,i,l=e._csvData,d=e._wrap_className,o=e._startNum,s=e._chartWrap_className,c=e._chart_className,u=(e._openBtn_className,e._openBtn_className),f=e._lineStroke,p=e._defaultLineColor_1,x=e._defaultLineColor_2,h=e._drawLineColor,m=e._margins,_=[],v=[],g=!0,y=e._mobileChk,k=t(s),A=k.width(),N=Math.ceil(A/1.5);y&&(N=Math.ceil(A/1.3)),r=A-(m.left+m.right),i=N-(m.top+m.bottom);var w,C,L,P,b,S=l.length-1,D=r/S,T=e._minNum,B=e._maxNum;n()}})(jQuery);var lineSet=d3.svg.line().x(function(t){return t[0]}).y(function(t){return t[1]});d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})};